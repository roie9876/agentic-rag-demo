#!/usr/bin/env python3
"""
M365 Teams Admin Permission Guide
=================================
This script explains exactly what permissions are needed and where to find them.
"""

def explain_teams_admin_permissions():
    print("=" * 70)
    print("ğŸ”‘ TEAMS ADMIN PERMISSIONS - DETAILED GUIDE")
    print("=" * 70)
    
    print("\nğŸ¯ EXACT PERMISSIONS NEEDED:")
    print("-" * 40)
    print("To upload apps to the Microsoft Teams App Catalog, you need")
    print("one of these Azure AD roles assigned to your user account:")
    print()
    print("1. ğŸ† Teams Administrator (Recommended)")
    print("   â€¢ Role ID: 69091246-20e8-4a56-aa4d-066075b2a7a8")
    print("   â€¢ Allows full Teams management")
    print("   â€¢ Can upload, approve, and manage Teams apps")
    print()
    print("2. ğŸŒ Global Administrator")
    print("   â€¢ Role ID: 62e90394-69f5-4237-9190-012177145e10")
    print("   â€¢ Full tenant control (usually restricted)")
    print()
    print("3. ğŸ“± Teams Communications Administrator")
    print("   â€¢ Role ID: baf37b3a-610e-45da-9e62-d9d1e5e8914b")
    print("   â€¢ Focus on calling and meetings")
    print("   â€¢ May also allow app uploads")

def show_where_to_find_permissions():
    print("\n" + "=" * 70)
    print("ğŸ“ WHERE TO CHECK/ASSIGN PERMISSIONS")
    print("=" * 70)
    
    print("\nğŸ” METHOD 1: Azure Portal (Recommended)")
    print("-" * 40)
    print("1. Go to: https://portal.azure.com")
    print("2. Navigate: Azure Active Directory â†’ Users")
    print("3. Search for your user account")
    print("4. Click on your user â†’ Assigned roles")
    print("5. Check if you have any of these roles:")
    print("   â€¢ Teams Administrator")
    print("   â€¢ Global Administrator")
    print("   â€¢ Teams Communications Administrator")
    print()
    print("ğŸ“‹ If you DON'T see these roles:")
    print("   â†’ You need an admin to assign them")
    print("   â†’ Contact your IT administrator")
    
    print("\nğŸ” METHOD 2: Microsoft 365 Admin Center")
    print("-" * 40)
    print("1. Go to: https://admin.microsoft.com")
    print("2. Navigate: Users â†’ Active users")
    print("3. Find your user account")
    print("4. Click on user â†’ Manage roles")
    print("5. Look for 'Teams Administrator' role")
    
    print("\nğŸ” METHOD 3: PowerShell Check")
    print("-" * 40)
    print("Run this PowerShell command to check your roles:")
    print()
    print("```powershell")
    print("# Connect to Azure AD")
    print("Connect-AzureAD")
    print()
    print("# Get your user roles")
    print("$user = Get-AzureADUser -ObjectId 'your@email.com'")
    print("Get-AzureADUserMembership -ObjectId $user.ObjectId | ")
    print("  Where-Object {$_.DisplayName -like '*Teams*' -or $_.DisplayName -like '*Global*'}")
    print("```")

def explain_permission_assignment():
    print("\n" + "=" * 70)
    print("ğŸ‘‘ HOW TO GET PERMISSIONS ASSIGNED")
    print("=" * 70)
    
    print("\nğŸ“§ REQUEST FROM IT ADMIN:")
    print("-" * 40)
    print("Send this email template to your IT administrator:")
    print()
    print("```")
    print("Subject: Request for Teams Administrator Role")
    print()
    print("Hi [IT Admin],")
    print()
    print("I need to deploy Microsoft 365 apps/plugins for our organization.")
    print("To upload apps to the Teams App Catalog, I need the 'Teams Administrator'")
    print("role assigned to my account.")
    print()
    print("User Account: [your@email.com]")
    print("Required Role: Teams Administrator")
    print("Reason: Deploy M365 Copilot plugins via PowerShell")
    print()
    print("This role allows me to:")
    print("- Upload custom Teams apps")
    print("- Manage app permissions")
    print("- Use PowerShell Teams module for deployment")
    print()
    print("Please assign this role in Azure Portal â†’ Users â†’ [My Account] â†’ Assigned roles")
    print()
    print("Thanks!")
    print("```")
    
    print("\nğŸ”§ STEPS FOR ADMIN TO ASSIGN ROLE:")
    print("-" * 40)
    print("If you ARE an admin, follow these steps:")
    print("1. Go to: https://portal.azure.com")
    print("2. Azure Active Directory â†’ Users")
    print("3. Find the user account")
    print("4. Click: Assigned roles â†’ + Add assignment")
    print("5. Search for: 'Teams Administrator'")
    print("6. Select the role â†’ Add")
    print("7. Verify: Role appears in 'Assigned roles' list")

def explain_alternative_approaches():
    print("\n" + "=" * 70)
    print("ğŸ”„ ALTERNATIVE APPROACHES (If You Can't Get Admin Role)")
    print("=" * 70)
    
    print("\n1. ğŸ“± Manual Upload (No Special Permissions Needed)")
    print("-" * 50)
    print("â€¢ Go to: https://admin.teams.microsoft.com/policies/manage-apps")
    print("â€¢ Click: 'Upload new app'")
    print("â€¢ Select: appPackage.zip")
    print("â€¢ This works with basic Teams permissions")
    print()
    print("2. ğŸ”„ Sideloading (For Testing)")
    print("-" * 50)
    print("â€¢ Go to: Teams client â†’ Apps â†’ Upload a custom app")
    print("â€¢ Select: appPackage.zip")
    print("â€¢ App will be available only to you/your team")
    print()
    print("3. ğŸ‘¥ Request IT Team Deployment")
    print("-" * 50)
    print("â€¢ Provide appPackage.zip to IT team")
    print("â€¢ They can upload it using their admin permissions")
    print("â€¢ Include deployment instructions from our PowerShell script")
    print()
    print("4. ğŸ” Service Account Approach")
    print("-" * 50)
    print("â€¢ Create a dedicated service account")
    print("â€¢ Assign Teams Administrator role to service account")
    print("â€¢ Use that account for automated deployments")

def show_verification_steps():
    print("\n" + "=" * 70)
    print("âœ… HOW TO VERIFY PERMISSIONS WORK")
    print("=" * 70)
    
    print("\nğŸ“‹ STEP-BY-STEP VERIFICATION:")
    print("-" * 40)
    print("1. Check role assignment:")
    print("   â†’ Azure Portal â†’ Users â†’ [Your Account] â†’ Assigned roles")
    print("   â†’ Should see 'Teams Administrator'")
    print()
    print("2. Test Teams Admin Center access:")
    print("   â†’ Go to: https://admin.teams.microsoft.com")
    print("   â†’ Navigate to: Teams apps â†’ Manage apps")
    print("   â†’ Should see 'Upload new app' button")
    print()
    print("3. Test PowerShell deployment:")
    print("   â†’ Run: pwsh ./deploy_m365_powershell.ps1")
    print("   â†’ Should succeed without authorization errors")
    print()
    print("4. Verify app appears:")
    print("   â†’ Teams Admin Center â†’ Manage apps")
    print("   â†’ Search for your app name")
    print("   â†’ Should appear in the list")

def main():
    explain_teams_admin_permissions()
    show_where_to_find_permissions()
    explain_permission_assignment()
    explain_alternative_approaches()
    show_verification_steps()
    
    print("\n" + "=" * 70)
    print("ğŸ¯ QUICK SUMMARY")
    print("=" * 70)
    print("PROBLEM: Need 'Teams Administrator' role")
    print("SOLUTION: Ask IT admin to assign role in Azure Portal")
    print("CHECK: Azure Portal â†’ Users â†’ [You] â†’ Assigned roles")
    print("TEST: https://admin.teams.microsoft.com/policies/manage-apps")
    print("=" * 70)

if __name__ == "__main__":
    main()
